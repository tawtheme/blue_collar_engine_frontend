<div class="page-title-box items-center sticky-top">
    <div class="container-xxl">
        <div class="d-flex items-center">
            <h4 class="page-title">Dashboard</h4>
            <div class="page-title-right d-flex align-items-center gap-3 ms-auto">
                <div class="dropdown">
                    <button type="button" class="btn btn-primary dropdown-toggle gap-2" data-bs-toggle="dropdown"
                        data-bs-display="static" aria-expanded="false">
                        <span class="icon-add font12"></span>Add New<span class="icon-down-arrow"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a href="/admin/create-estimate">Create Estimate</a>
                        </li>
                        <li><a href="/admin/create-invoice">Create Invoice</a>
                        </li>
                    </ul>
                </div>
                <!--
                <button type="button" class="btn btn-primary  gap-2" (click)="openOnBoardModel()">
                    Open On-Board
                </button>
                -->
            </div>
        </div>
    </div>
</div>

<div class="container-xxl pb-5">
    <div class="mt-5">
        <div class="row">
            <div class="col-3">
                <div class="py-2 px-3 border rounded">
                    <h4 class="my-1">{{stats?.totalBookingCount}}</h4>
                    <p class="mb-0 font13 font-muted">Total Booking</p>
                </div>
            </div>
            <div class="col-3">
                <div class="py-2 px-3 border rounded">
                    <h4 class="my-1">{{stats?.totalEstimateCount}}</h4>
                    <p class="mb-0 font13 font-muted">Total Estimate</p>
                </div>
            </div>
            <div class="col-3">
                <div class="py-2 px-3 border rounded">
                    <h4 class="my-1">{{stats?.totalInvoiceCount}}</h4>
                    <p class="mb-0 font13 font-muted">Total Invoice</p>
                </div>
            </div>
            <div class="col-3">
                <div class="py-2 px-3 border rounded">
                    <h4 class="my-1">${{stats?.totalRevenueAmt | number : '1.2-2'}}</h4>
                    <p class="mb-0 font13 font-muted">Total Revenue</p>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5">
        <div class="d-flex align-items-center">
            <h3 class="mb-0 font15">Quick Overview</h3>
            <div class="ms-auto">
                <mat-form-field class="muiDatePickerFromField " (click)="picker.open()">
                    <mat-date-range-input [rangePicker]="picker" [formGroup]="dashboardRagePickerForm"
                        [comparisonStart]="dashboardRagePickerForm.value.start"
                        [comparisonEnd]="dashboardRagePickerForm.value.end">
                        <input matStartDate formControlName="start" placeholder="Start date">
                        <input matEndDate formControlName="end" placeholder="End date"
                            (dateChange)="rangeChangeEvent()">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                </mat-form-field>
            </div>
        </div>
        <div class="border rounded mt-2 overflow-hidden">
            <!-- <div class="border-bottom px-4">
                <div class="row">
                    <div class="col-3">
                        <div class="py-2">
                            <h4 class="my-1">{{stats?.totalBookingCount}}</h4>
                            <p class="mb-0 font13 font-muted">Total Booking</p>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="py-2">
                            <h4 class="my-1">{{stats?.totalEstimateCount}}</h4>
                            <p class="mb-0 font13 font-muted">Total Estimate</p>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="py-2">
                            <h4 class="my-1">{{stats?.totalInvoiceCount}}</h4>
                            <p class="mb-0 font13 font-muted">Total Invoice</p>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="py-2">
                            <h4 class="my-1">${{stats?.totalRevenueAmt | number : '1.2-2'}}</h4>
                            <p class="mb-0 font13 font-muted">Total Revenue</p>
                        </div>
                    </div>
                </div>
            </div> -->
            <!-- <div id="container"></div> -->
            <div id="chart">
                <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart"
                    [dataLabels]="chartOptions.dataLabels" [plotOptions]="chartOptions.plotOptions"
                    [yaxis]="chartOptions.yaxis" [legend]="chartOptions.legend" [fill]="chartOptions.fill"
                    [stroke]="chartOptions.stroke" [tooltip]="chartOptions.tooltip"
                    [xaxis]="chartOptions.xaxis"></apx-chart>
            </div>
            <div id="pie-chart">
                <apx-chart [series]="pieChartOptions.series" [chart]="pieChartOptions.chart"
                    [labels]="pieChartOptions.labels" [responsive]="pieChartOptions.responsive"></apx-chart>
            </div>

        </div>
    </div>

    <div class="mt-5">
        <div class="row gx-md-5">
            <div class="col-lg-4">
                <div class="d-flex align-items-center mb-2">
                    <h4 class="font15 font600">Recent Booking</h4>
                    <a href="/admin/bookings" class="ms-auto font13">View All</a>
                </div>
                <div class="border rounded recent-wrapper">
                    <div class="p-3 recentListing" *ngFor="let booking of todayBooking">
                        <div class="d-flex gap-3 mb-2">
                            <span class="grey-badge"><span class="icon-time"></span> {{booking.bookingTime}}</span>
                            <button class="danger-badge" type="button">{{booking.statusText}}</button>
                        </div>
                        <h4 class="font14 mb-1 font500">{{booking.customerName}}</h4>
                        <p class="font13 mb-0 font-muted">{{booking.address}}, {{booking.city}}, {{booking.state}},
                            {{booking.zipCode}}</p>
                    </div>
                    <div *ngIf="todayBooking.length==0 && !todayBookingLoaded" class="p-3 text-center">
                        <span>No data found</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="d-flex align-items-center mb-2">
                    <h4 class="font15 font600">Recent Estimate</h4>
                    <a href="/admin/estimate" class="ms-auto font13">View All</a>
                </div>
                <div class="border rounded recent-wrapper">
                    <div class="p-3 recentListing" *ngFor="let estimate of estimateInvoices">
                        <div class="d-flex gap-3 mb-2">
                            <span class="grey-badge"><span class="icon-calendar"></span> {{estimate.createdDate |
                                date:'mediumDate'}}</span>
                            <button class="warning-badge" type="button">{{estimate.status}}</button>
                        </div>
                        <div class="d-flex align-items-top justify-content-between gap-3">
                            <div class="d-flex flex-column align-items-start justify-content-center">
                                <h4 class="font14 mb-1 font500">{{estimate.firstName}} {{estimate.lastName}}</h4>
                                <p class="font13 mb-0 font-muted">{{estimate.serviceAddress}}</p>
                            </div>
                            <div>
                                <h4 class="font14 mb-1 ms-auto font500">${{estimate.totalAmount | number : '1.2-2'}}
                                </h4>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="estimateInvoices.length==0 && !estimateInvoiceLoaded" class="p-3 text-center">
                        <span>No data found</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="d-flex align-items-center mb-2">
                    <h4 class="font15 font600">Recent Invoice</h4>
                    <a href="/admin/invoice" class="ms-auto font13">View All</a>
                </div>
                <div class="border rounded recent-wrapper">
                    <div class="p-3 recentListing" *ngFor="let invoice of invoices">
                        <div class="d-flex gap-3 mb-2">
                            <span class="grey-badge"><span class="icon-calendar"></span> {{invoice.createdDate |
                                date:'mediumDate'}}</span>
                            <button class="warning-badge">{{invoice.status}}</button>
                        </div>
                        <div class="d-flex align-items-top justify-content-between gap-3">
                            <div class="d-flex flex-column align-items-start justify-content-center">
                                <h4 class="font14 mb-1 font500">{{invoice.firstName}} {{invoice.lastName}}</h4>
                                <p class="font13 mb-0 font-muted">{{invoice.serviceAddress}}</p>
                            </div>
                            <div>
                                <h4 class="font14 mb-1 ms-auto font500">${{invoice.totalAmount | number : '1.2-2'}}</h4>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="invoices.length==0 && !invoiceLoaded" class="p-3 text-center">
                        <span>No data found</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5">
        <div class="row gx-lg-5">
            <div class="col-lg-7">
                <h4 class="font15 font600 mb-2">Top Technician </h4>
                <div class="border rounded popularSection">
                    <table class="row-border">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Revenue</th>
                                <th>Sales</th>
                                <th>Sucess Rate</th>
                                <th>Customer Rating</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let tech of technician">
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="ShapeCircle20">
                                            <img [src]="tech.profileImagePath" class="img-fluid rounded-2"
                                                (error)="tech.profileImagePath = '../../../../assets/images/blank-img.png'">
                                        </div>
                                        {{tech.fullName}}
                                    </div>
                                </td>
                                <td>${{tech.totalRevenue | number : '1.2-2'}}</td>
                                <td>{{tech.totalSalesCount}}</td>
                                <td>{{tech.successRate}}%</td>
                                <td>
                                    <!--<div class="d-flex gap-2 align-items-center justify-content-center custom-star">
                                        <app-star-rating [rating]="rating" [starCount]="starCount" [color]="starColor"
                                            (ratingUpdated)="onRatingChanged($event)"
                                            [customDisable]="starDisable"></app-star-rating>
                                    </div>-->
                                    <span class="success-badge">4/5</span>
                                </td>
                            </tr>
                            <tr *ngIf="technician.length==0 && !technicianLoaded">
                                <td class="text-center" colspan="4">
                                    <span>No data found</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-lg-5">
                <h4 class="font15 font600 mb-2">Popular Service</h4>
                <div class="border rounded popularSection">
                    <table>
                        <thead>
                            <tr>
                                <th>Service Name</th>
                                <th>Sales</th>
                                <th>Revenue</th>
                                <!-- <th>Rating</th> -->
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let service of topServices">
                                <td> {{service.serviceName}} </td>
                                <td>{{service.totalSalesCount}}</td>
                                <td>${{service.totalRevenue | number : '1.2-2'}}</td>
                                <!-- <td>
                                    <div class="d-flex gap-2 align-items-center justify-content-center custom-star">
                                        <app-star-rating [rating]="rating" [starCount]="starCount" [color]="starColor"
                                            (ratingUpdated)="onRatingChanged($event)"
                                            [customDisable]="starDisable"></app-star-rating>                                    
                                    </div>
                                </td> -->
                            </tr>
                            <tr *ngIf="topServices.length==0 && !topServicesLoaded">
                                <td class="text-center" colspan="4">
                                    <span>No data found</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>